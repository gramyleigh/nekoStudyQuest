<!-- templates/past_tests.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Past Tests Archive - Neko Study Quest</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Comic+Neue:wght@400;700&family=Luckiest+Guy&family=Indie+Flower&family=Architects+Daughter&family=Crafty+Girls&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary: #ff5f8f;
            --primary-dark: #e91e63;
            --primary-light: #ffcce6;
            --secondary: #6b58cd;
            --secondary-dark: #4a3a9c;
            --accent: #ffeb3b;
            --success: #66bb6a;
            --danger: #f44336;
            --warning: #ff9800;
            --dark: #333;
            --light: #fff;
            --chart-bg: rgba(255, 255, 255, 0.85);
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        body {
            font-family: 'Comic Neue', cursive;
            margin: 0;
            padding: 0;
            position: relative;
            min-height: 100vh;
            background-color: transparent;
            color: var(--dark);
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ff8db4' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"),
                          url("data:image/svg+xml,%3Csvg width='52' height='26' viewBox='0 0 52 26' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%236b58cd' fill-opacity='0.1'%3E%3Cpath d='M10 10c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4v2c-3.314 0-6-2.686-6-6 0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6zm25.464-1.95l8.486 8.486-1.414 1.414-8.486-8.486 1.414-1.414z' /%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        header {
            text-align: center;
            padding: 20px 0;
            position: relative;
        }

        h1 {
            font-family: 'Luckiest Guy', cursive;
            color: var(--primary);
            font-size: 3.5rem;
            margin: 0 0 20px 0;
            text-transform: uppercase;
            letter-spacing: 3px;
            -webkit-text-stroke: 2px var(--dark);
            text-shadow:
                4px 4px 0 var(--dark),
                -2px -2px 0 var(--primary-light),
                2px 2px 8px rgba(0,0,0,0.3);
            display: inline-block;
            position: relative;
            transform: rotate(-1deg);
            z-index: 2;
        }

        /* Emoji decorations for title */
        h1::before, h1::after {
            position: absolute;
            font-size: 2rem;
            top: 5px;
        }

        h1::before {
            content: "üìö";
            left: -40px;
            animation: float-animation 3s ease-in-out infinite;
        }

        h1::after {
            content: "üìù";
            right: -40px;
            animation: float-animation 3s ease-in-out infinite reverse;
        }

        @keyframes float-animation {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-10px) rotate(10deg); }
        }

        h2 {
            font-family: 'Bangers', cursive;
            color: var(--secondary);
            font-size: 2.2rem;
            letter-spacing: 1px;
            margin: 20px 0;
            text-shadow: 2px 2px 0 var(--primary-light);
            position: relative;
            display: inline-block;
        }

        h2::after {
            content: "";
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 8px;
            background-color: var(--primary-light);
            z-index: -1;
            transform: rotate(-1deg);
        }

        h3 {
            font-family: 'Bangers', cursive;
            color: var(--primary-dark);
            font-size: 1.8rem;
            letter-spacing: 1px;
            margin-bottom: 15px;
            position: relative;
            display: inline-block;
        }

        h3::after {
            content: "";
            position: absolute;
            left: 0;
            bottom: -2px;
            width: 100%;
            height: 4px;
            background-color: var(--primary-light);
            border-radius: 2px;
        }

        .page-intro {
            text-align: center;
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 40px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 15px;
            font-weight: bold;
            font-family: 'Crafty Girls', cursive;
            backdrop-filter: blur(5px);
            border: 3px solid var(--primary);
            box-shadow: 5px 5px 0 var(--dark);
            position: relative;
        }

        .test-card {
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 5px 5px 0 var(--dark);
            border: 3px solid var(--primary);
            position: relative;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 8px 8px 0 var(--dark);
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .test-title {
            font-weight: bold;
            font-size: 1.8rem;
            color: var(--secondary);
            font-family: 'Architects Daughter', cursive;
        }

        .test-subject {
            font-style: italic;
            color: var(--primary-dark);
            font-size: 1.2rem;
            font-family: 'Comic Neue', cursive;
            margin-top: 5px;
        }

        .test-date {
            font-weight: bold;
            color: var(--primary-dark);
            font-size: 1.1rem;
            background-color: var(--primary-light);
            padding: 5px 10px;
            border-radius: 10px;
            border: 2px solid var(--dark);
            box-shadow: 2px 2px 0 var(--dark);
        }

        .test-result {
            background-color: var(--light);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border: 2px dashed var(--secondary);
        }

        .result-heading {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--secondary);
            margin-bottom: 10px;
            font-family: 'Bangers', cursive;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
        }

        .result-heading::before {
            content: "üèÜ";
            margin-right: 10px;
        }

        .result-grade {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark);
            background-color: var(--accent);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            border: 2px solid var(--dark);
            box-shadow: 3px 3px 0 var(--dark);
        }

        .result-info {
            display: flex;
            align-items: center;
        }

        .result-details {
            flex: 1;
        }

        .test-overview {
            margin: 20px 0;
        }

        .overview-title {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--secondary);
            margin-bottom: 10px;
            font-family: 'Bangers', cursive;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
        }

        .overview-title::before {
            content: "üìä";
            margin-right: 10px;
        }

        .progress-bar-container {
            width: 100%;
            height: 25px;
            background-color: rgba(245, 245, 245, 0.7);
            border-radius: 15px;
            margin: 10px 0;
            overflow: hidden;
            border: 2px solid var(--dark);
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--success);
            text-align: center;
            line-height: 25px;
            color: white;
            font-weight: bold;
            font-size: 14px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: progress-shine 2s infinite;
        }

        @keyframes progress-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .test-statistics {
            margin-top: 20px;
        }

        .chart-container {
            background-color: var(--chart-bg);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border: 2px solid var(--dark);
            position: relative;
            height: 200px;
        }

        .back-button {
            background-color: var(--secondary);
            border: none;
            color: var(--light);
            padding: 15px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            font-size: 18px;
            cursor: pointer;
            border-radius: 10px;
            font-family: 'Bangers', cursive;
            letter-spacing: 1px;
            font-weight: bold;
            box-shadow: 4px 4px 0 var(--dark);
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            width: fit-content;
            border: 2px solid var(--dark);
            backdrop-filter: blur(5px);
        }

        .back-button::before {
            content: "üè†";
            margin-right: 8px;
        }

        .back-button:hover {
            background-color: var(--secondary-dark);
            transform: translateY(-4px) rotate(-2deg);
            box-shadow: 6px 6px 0 var(--dark);
        }

        .no-tests {
            text-align: center;
            padding: 50px;
            font-style: italic;
            color: var(--dark);
            font-size: 1.5rem;
            font-family: 'Crafty Girls', cursive;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            box-shadow: 5px 5px 0 var(--primary-light);
            border: 3px dashed var(--primary);
            margin: 40px auto;
            max-width: 600px;
            backdrop-filter: blur(5px);
            position: relative;
        }

        .no-tests::after {
            content: "üò∫";
            display: block;
            font-size: 2.5rem;
            margin-top: 15px;
        }

        .cat-paw {
            position: absolute;
            top: -20px;
            right: -20px;
            width: 40px;
            height: 40px;
            background-color: var(--primary-light);
            border-radius: 50%;
            border: 3px solid var(--dark);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            transform: rotate(15deg);
            box-shadow: 3px 3px 0 var(--dark);
            z-index: 2;
        }

        /* Floating cat emojis */
        .cat-float-container {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: -1;
        }

        .floating-cat {
            position: absolute;
            font-size: 3rem;
            animation: float-around 25s linear infinite;
            opacity: 0.6;
        }

        @keyframes float-around {
            0% {
                transform: translateY(0) rotate(0);
            }
            25% {
                transform: translateY(-20px) rotate(10deg);
            }
            50% {
                transform: translateY(0) rotate(0);
            }
            75% {
                transform: translateY(20px) rotate(-10deg);
            }
            100% {
                transform: translateY(0) rotate(0);
            }
        }

        /* Paw print decorations */
        .paw-print {
            position: absolute;
            font-size: 1.5rem;
            opacity: 0.3;
            transform: rotate(var(--rotate));
            z-index: -1;
        }

        /* Scattered emoji decorations */
        .emoji-decor {
            position: absolute;
            font-size: 1.5rem;
            opacity: 0.4;
            animation: pulse 3s infinite;
            z-index: -1;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.4; }
            50% { transform: scale(1.1); opacity: 0.5; }
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 2.5rem;
            }

            .test-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .test-date {
                margin-top: 10px;
            }

            .result-info {
                flex-direction: column;
                align-items: flex-start;
            }

            .result-grade {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Past Tests Archive</h1>
        </header>

        <div class="page-intro">
            Review your past tests, see what you've studied, and learn from your preparation journey! Each test includes your progress statistics, study resources, and performance data to help you improve for future exams.
            <div class="cat-paw">üêæ</div>
        </div>

        {% if past_tests and past_tests|length > 0 %}
            {% for test in past_tests %}
                <div class="test-card">
                    <div class="test-header">
                        <div>
                            <div class="test-title">{{ test.test_name }}</div>
                            <div class="test-subject">{{ test.subject_name }}</div>
                        </div>
                        <div class="test-date">{{ test.date }}</div>
                    </div>

                    <div class="test-overview">
                        <div class="overview-title">Study Progress</div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: {{ test.progress }}%">{{ test.progress }}%</div>
                        </div>

                        {% set completed_resources = test.records|length %}
                        {% set total_resources = 0 %}
                        {% for topic in test.topics %}
                            {% for resource in topic.resources %}
                                {% set total_resources = total_resources + resource.count %}
                            {% endfor %}
                        {% endfor %}

                        <p>You completed {{ completed_resources }} out of {{ total_resources }} planned resources.</p>
                    </div>

                    <div class="test-statistics">
                        <div class="chart-container">
                            <canvas id="progressChart-{{ test.test_id }}"></canvas>
                        </div>
                    </div>
                    <div class="cat-paw">üêæ</div>
                </div>
            {% endfor %}
        {% else %}
            <div class="no-tests">
                No past tests found. Come back after your scheduled tests have passed!
            </div>
        {% endif %}

        <a href="{{ url_for('index') }}" class="back-button">Back to Home</a>
    </div>

    <!-- Floating cat emojis -->
    <div class="cat-float-container">
        <div class="floating-cat" style="top: 10%; left: 5%; animation-delay: 0s;">üê±</div>
        <div class="floating-cat" style="top: 60%; left: 8%; animation-delay: -5s;">üò∫</div>
        <div class="floating-cat" style="top: 30%; left: 85%; animation-delay: -10s;">üò∏</div>
        <div class="floating-cat" style="top: 70%; left: 75%; animation-delay: -15s;">üòª</div>
        <div class="floating-cat" style="top: 20%; left: 40%; animation-delay: -20s;">üêà</div>
    </div>

    <!-- Paw print decorations -->
    <div class="paw-print" style="top: 100px; left: 50px; --rotate: 20deg;">üêæ</div>
    <div class="paw-print" style="bottom: 120px; left: 80px; --rotate: -15deg;">üêæ</div>
    <div class="paw-print" style="top: 200px; right: 60px; --rotate: -30deg;">üêæ</div>
    <div class="paw-print" style="bottom: 150px; right: 70px; --rotate: 10deg;">üêæ</div>

    <!-- Scattered emoji decorations -->
    <div class="emoji-decor" style="top: 15%; left: 20%; animation-delay: 0s;">üìö</div>
    <div class="emoji-decor" style="top: 75%; left: 30%; animation-delay: -1s;">üìù</div>
    <div class="emoji-decor" style="top: 35%; left: 85%; animation-delay: -2s;">‚ú®</div>
    <div class="emoji-decor" style="top: 65%; left: 15%; animation-delay: -3s;">üéì</div>
    <div class="emoji-decor" style="top: 25%; left: 75%; animation-delay: -4s;">üìä</div>

    <script>
        // Simple example charts for past test data
        document.addEventListener('DOMContentLoaded', function() {
            // Set custom Chart.js defaults to match our theme
            Chart.defaults.font.family = "'Comic Neue', cursive";
            Chart.defaults.font.size = 14;
            Chart.defaults.color = "#333";
            Chart.defaults.borderColor = "rgba(106, 90, 205, 0.2)";

            {% if past_tests and past_tests|length > 0 %}
                {% for test in past_tests %}
                    // Create chart for each test
                    const ctx{{ loop.index }} = document.getElementById('progressChart-{{ test.test_id }}').getContext('2d');

                    // Calculate actual metrics based on real data
                    {% set completed_resources = test.records|length %}
                    {% set total_topics = test.topics|length %}
                    {% set topics_with_progress = 0 %}

                    {% for topic in test.topics %}
                        {% set topic_records = 0 %}
                        {% for record in test.records %}
                            {% if record.topic_id == topic.id %}
                                {% set topic_records = topic_records + 1 %}
                            {% endif %}
                        {% endfor %}

                        {% if topic_records > 0 %}
                            {% set topics_with_progress = topics_with_progress + 1 %}
                        {% endif %}
                    {% endfor %}

                    {% set study_hours = completed_resources * 0.5 %}  // Assuming each resource takes 30 mins
                    {% set mastered_topics = (topics_with_progress / total_topics * 100)|round(0, 'floor')|int if total_topics > 0 else 0 %}

                    const progressChart{{ loop.index }} = new Chart(ctx{{ loop.index }}, {
                        type: 'bar',
                        data: {
                            labels: ['Study Time (hrs)', 'Resources Completed', 'Topics Progress (%)'],
                            datasets: [{
                                label: 'Test Preparation',
                                data: [
                                    {{ study_hours }},
                                    {{ completed_resources }},
                                    {{ mastered_topics }}
                                ],
                                backgroundColor: [
                                    'rgba(255, 95, 143, 0.7)',
                                    'rgba(106, 90, 205, 0.7)',
                                    'rgba(102, 187, 106, 0.7)'
                                ],
                                borderColor: '#333',
                                borderWidth: 2,
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.dataset.label || '';
                                            const value = context.parsed.y;
                                            const index = context.dataIndex;

                                            if (index === 0) {
                                                return `${label}: ${value} hours`;
                                            } else if (index === 1) {
                                                return `${label}: ${value} resources`;
                                            } else if (index === 2) {
                                                return `${label}: ${value}% of topics`;
                                            }
                                            return `${label}: ${value}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value, index, values) {
                                            return value;
                                        }
                                    }
                                }
                            }
                        }
                    });
                {% endfor %}
            {% endif %}
        });
    </script>
</body>
</html>